name: Run AlgoPari

on:
  schedule:
    - cron: "0 7 * * *"   # tous les jours √† 07:00 UTC
  workflow_dispatch:      # permet un lancement manuel

# ‚Üê IMPORTANT : autorise l'√©criture dans le d√©p√¥t par le token
permissions:
  contents: write

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout repo
        uses: actions/checkout@v3
        with:
          persist-credentials: true  # important pour pouvoir push avec GITHUB_TOKEN

      - name: üêç Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ‚ñ∂Ô∏è Run main.py
        run: |
          python main.py

      - name: üîé Show git status (debug)
        run: |
          git status --porcelain
          echo "---- staged changes ----"
          git diff --staged --name-only || true

      - name: üì§ Commit & push results if changed
        run: |
          # Ajouter les dossiers (supprime '|| true' si tu veux √©chouer si erreur)
          git add results/ logs/ || true

          # Si des changements sont staged -> commit & push
          if ! git diff --staged --quiet; then
            git commit -m "Mise √† jour r√©sultats et logs [skip ci]" || true
            git push
          else
            echo "Aucun changement √† committer."
          fi
